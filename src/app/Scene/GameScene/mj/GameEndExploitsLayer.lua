
local GameEndExploitsLayer = class("GameEndExploitsLayer", lt.BaseLayer, function()

    return cc.CSLoader:createNode("game/mjcomm/gwidget/ResultShareLayer.csb")
end)
local posY = 80
function GameEndExploitsLayer:ctor()
	GameEndExploitsLayer.super.ctor(self)
	self._image_Content = self:getChildByName("Image_Content")
    self._node_ResultInfo = self._image_Content:getChildByName("Node_ResultInfo")--玩家成绩信息
    self._node_GameInfo = self._image_Content:getChildByName("Node_GameInfo")   --房间信息
end
function GameEndExploitsLayer:show(info)
    local roomInfo = lt.DataManager:getGameRoomInfo()

    local BigScore = info[1][1].score --最大分
    local playePos = 1 --位置变量
    for k,v in ipairs(info[1]) do
        local playerNode = self._node_ResultInfo:getChildByName("FileNode_Item_"..k)
        playerNode:setVisible(true)
        if BigScore == v.score then
            local AtlasLabel_LostRank = playerNode:getChildByName("AtlasLabel_LostRank")
            AtlasLabel_LostRank:setVisible(false)
            local Image_LostBg = playerNode:getChildByName("Image_LostBg")
            Image_LostBg:setVisible(false)
            local AtlasLabel_WinScore = playerNode:getChildByName("AtlasLabel_WinScore")
            AtlasLabel_WinScore:setString(v.score)
            local AtlasLabel_LostScore = playerNode:getChildByName("AtlasLabel_LostScore")
            AtlasLabel_LostScore:setVisible(false)
            local Sprite_WinTitle = playerNode:getChildByName("Sprite_WinTitle")
            Sprite_WinTitle:setVisible(true)

        else
            local Sprite_WinTitle = playerNode:getChildByName("Sprite_WinTitle")
            Sprite_WinTitle:setVisible(false)

            playePos = playePos + 1
            local AtlasLabel_LostRank = playerNode:getChildByName("AtlasLabel_LostRank")
            AtlasLabel_LostRank:setVisible(true)
            AtlasLabel_LostRank:setString(playePos)
            local Image_LostBg = playerNode:getChildByName("Image_LostBg")
            Image_LostBg:setVisible(true)
            local Image_WinBg = playerNode:getChildByName("Image_WinBg")
            Image_LostBg:setVisible(true)
            Image_WinBg:setVisible(false)
            local AtlasLabel_LostScore = playerNode:getChildByName("AtlasLabel_LostScore")
            if tonumber(v.score) < 0 then
                local pjNum = self:getIntPart(tonumber(v.score))
                local tt = tostring(pjNum)
                AtlasLabel_LostScore:setString("/"..tt)
            else
                AtlasLabel_LostScore:setString(v.score)
            end
            local AtlasLabel_WinScore = playerNode:getChildByName("AtlasLabel_WinScore")
            AtlasLabel_WinScore:setVisible(false)


        end
       
        local Text_UserId = playerNode:getChildByName("Text_UserId")
        Text_UserId:setString("ID: "..v.user_id)
        local Text_Name = playerNode:getChildByName("Text_Name")
        for i=1,#roomInfo.players do
            if v.user_id == roomInfo.players[i].user_id then
                Text_Name:setString(roomInfo.players[i].user_name)
            end
        end
    end

    local Text_Time = self._node_GameInfo:getChildByName("Text_Time")--开始时间
    local Text_RoomNum = self._node_GameInfo:getChildByName("Text_RoomNum")--房号
    local Text_BaseCode = self._node_GameInfo:getChildByName("Text_BaseCode")--底分
    local Text_ZiFei = self._node_GameInfo:getChildByName("Text_ZiFei")--资费
    local Text_RoomOnwer = self._node_GameInfo:getChildByName("Text_RoomOnwer")--房主
    Text_Time:setString(info[7].." 开始")
    Text_RoomNum:setString("房号: "..info[6].." 局数: "..info[4])
    Text_BaseCode:setString("底分: "..info[2])

    local text = lt.LanguageString:getString("ROOM_COST_"..info[3])
    Text_ZiFei:setString("资费: "..text)

    for i=1,#roomInfo.players do
            if info[5] == roomInfo.players[i].user_id then
                Text_RoomOnwer:setString("房主: "..roomInfo.players[i].user_name)
            end
    end
    --[[
    self:setRotation(90)
    self:setPosition(0,750)
    local oldTexture = cc.RenderTexture:create(1334,750)
    oldTexture:begin()
    self:visit()
    oldTexture:endToLua()

    local filename = "ShareFightResult.png"
    oldTexture:saveToFile(filename, 1)--]]
    ---[[
    self:setRotation(90)
    self:setPosition(0,750)
    local oldTexture = cc.RenderTexture:create(1334,750)
    oldTexture:begin()
    self:visit()
    oldTexture:endToLua()

    oldTexture:setRotation(-90)
    oldTexture:setPosition(cc.p(325,667))

    local newTexture = cc.RenderTexture:create(750, 1334)

    newTexture:begin()
    oldTexture:visit()
    newTexture:endToLua()

    local filename = "ShareFightResult.png"

    newTexture:saveToFile(filename, 1)--]]

    local path = cc.FileUtils:getInstance():getWritablePath() .. filename
    ---[[
    local callBack = function(str) 
        print("FYD===>>",str)
    end
    lt.Luaj.callStaticMethod("com/mengya/common/PlatformSDK", "registerCallBack",{callBack},"(I)V")    
    local ok,ret = lt.Luaj.callStaticMethod("com/mengya/wechat/WechatDelegate", "wxshareImg",{path},"(Ljava/lang/String;)V")--]]

--[[

    local render_texture = cc.RenderTexture:create(750,1334)
    render_texture:begin()
    self:visit()
    render_texture:endToLua()

    local filename = "ShareFightResult.png"

    render_texture:saveToFile(filename, 1)--]]


end

function GameEndExploitsLayer:getIntPart(x)
    local y = (-x)
    
    return y
end

function GameEndExploitsLayer:onEnter()
    print("GameEndExploitsLayer:onEnter")

end

function GameEndExploitsLayer:onExit()
    print("GameEndExploitsLayer:onExit")
end

return GameEndExploitsLayer